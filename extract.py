# -*- coding = utf-8 -*-
# @Time : 2024/9/15 20:15
# @Author : 小五
# @File : extract.py
# @Sofeware : PyCharm
import re
import os
import pprint
def extract_dict(text):
    # 输入文本，提取输出字典 键是法律要素 值是属性值或者文本

    # 处理特殊的案号和审理程序标签嵌套情况
    # 调换 案号 和 审理程序 的顺序
    text = re.sub(r'<案号><审理程序(?:\s+状态="(.*?)")?>(.*?)</案号></审理程序>', r'<审理程序 状态="\1"><案号>\2</案号></审理程序>', text)
    # 匹配标签、状态和内容，包括嵌套标签的处理
    pattern = r'<(\w+)(?:\s+状态="(.*?)")?>(.*?)</\1>'

    # 初始化一个空字典存储解析结果
    result_dict = {}

    # 查找所有直接匹配的标签
    matches = re.findall(pattern, text, re.DOTALL)

    for tag, status, inner_content in matches:
        # 清理内容中的空格和回车
        clean_content = re.sub(r'\s+', '', inner_content)

        # 如果匹配的内容中仍有标签，递归解析内部内容，并将其作为平行内容加入结果
        if re.search(r'<\w+', inner_content):
            # 递归解析嵌套内容
            nested_result = extract_dict(inner_content)
            result_dict.update(nested_result)  # 将嵌套内容平行加入字典中

        # 处理当前标签的内容，状态优先
        if status:
            result_dict[tag] = status
        else:
            # 过滤掉文本中的< ></ >
            clean_content = re.sub(r'<[^>]+>', '', clean_content)
            result_dict[tag] = clean_content

    return result_dict
elements_dict = {   "案件基本信息": {"提示词": "一般从原文开始，到'本案现已审理终结'"}, "案名": {"提示词": "纠纷"}, "审理法院": {"提示词": "人民法院"}, "案号": {"提示词": "号；民事判决书"},
"审理程序": {"属性": [ "一审", "二审","再审" ], "提示词": "初（一审）；终（二审）；再（再审）"}, "案件基本事实部分": {    },
"劳动者性别": { "属性": [ "男", "女" ], "提示词": "父亲；丈夫；儿子；哥——男；母亲；妻子；女儿；妹；女工人——女；"},"出生时间": {   }, "劳动起始时间": { "提示词": "入职；开始工作；自…到…；工龄" },
"劳动结束时间": { "提示词": "死亡；发生交通事故；受伤；车祸；解除劳动合同；离开工作岗位" }, "开始劳动的年龄": { "提示词": "入职；开始工作；"},
"结束劳动的年龄": { "提示词": "发生交通事故；死亡；受伤；" },
"有无书面合同": { "属性": [ "有", "无" ], "提示词": "签订书面劳动合同；劳务合同；雇佣协议书；协议书；聘用合同书；书面劳动合同；口头约定；无固定期限劳动合同"},
"仲裁委拒绝仲裁的理由": { "提示词": "申请仲裁；不予受理；年龄超过退休年龄"},
"劳动者何时达到法定退休年龄": { "属性": [ "劳动期间达到法定退休年龄", "劳动前达到法定退休年龄" ], "提示词": "乙方已达法定退休年龄；入职时已达到法定退休年龄；已达到法定退休年龄；劳动前达到法定退休年龄；"},
"结束劳动时是否达到法定退休年龄": { "属性": [ "是", "否" ], "提示词": "属于超过法定退休年龄；超过法定退休年龄"}, "有无享受养老保险待遇": { "属性": [ "有", "无" ], "提示词": "领取养老金；享受；城乡居民养老保险；城镇居民社会养老保险；新型农村社会养老保险；城镇职工基本养老保险待遇"},
"养老保险待遇类型": { "属性": [ "城乡居民养老保险", "城镇居民社会养老保险", "新型农村社会养老保险", "城镇职工基本养老保险待遇" ], "提示词": "城乡居民养老保险；城镇居民社会养老保险；新型农村社会养老保险；城镇职工基本养老保险待遇" },
"回顾一审法院的认定理由": {  }, "回顾一审法院的认定依据": { }, "回顾一审法院的裁判依据": {  }, "回顾一审法院的裁判结果": { "属性": [ "劳动关系", "劳务关系" ], },
"回顾二审法院的认定理由": {  },  "回顾二审法院的认定依据": {  },  "回顾二审法院的裁判依据": {  },  "回顾二审法院的裁判结果": {  "属性": [ "劳动关系", "劳务关系" ], }, "理由": {  },
"审理法院的认定理由": {  },  "审理法院的认定依据": {   }, "基本养老保险待遇的认定理由": {   }, "是否认定为基本养老保险待遇": {   "属性": [ "是", "否" ]},
"裁判依据": {   },  "审理法院的实体裁判依据": {   },  "裁判主文": {  "提示词": "判决如下"   },  "审理法院的对应裁判结果": {  "属性": [ "劳动关系", "劳务关系" ]},
"落款": {   }, "审结时间": {   },  "审理法官": {  }
}
def generate_user_prompt(element, panjueshu):
    # 初始化基础模板
    base_template = '请问在给定如下判决书中是否有与"{}"这个法律要素相关的文本？'

    # 获取该要素的细节描述
    element_detail = elements_dict.get(element, {})
    if "提示词" in element_detail:
        hint_description = f"该要素的提示词是：{element_detail['提示词']}。提示词仅供你一步步推理确定相关文本，不是最终的答案。"
        base_template += hint_description
    # 构建细节描述部分
    if "属性" in element_detail:
        attribute_description = f"该要素的可选属性值为：{element_detail['属性']}。如果找到相关文本，一步步思考然后输出该要素的属性值，不要输出其他多余推理信息；如果没有找到相关文本，则直接输出\"0\"。"
    else:
        attribute_description = "如果找到相关文本，则直接输出原文中与该要素相关的部分，注意输出原文本，不要修改原文，不要总结原文，也不要添加任何额外的信息；如果没有找到相关文本，则直接输出\"0\"。"



    # 组合细节描述
    res_template = base_template + attribute_description + "判决书内容如下：{}"
    res = res_template.format(element, panjueshu)
    # 填充模板并返回
    return res

def extract_number(filepath):
    # 提取文件名中的数字
    filename = os.path.basename(filepath)
    match = re.search(r'\d+', filename)
    if match:
        return match.group(0)
    return None

elements_prompt = {
    "案件基本信息": '请从以下法律判决书中提取与“案件基本信息”相关的部分。该部分通常包括案件的基本描述，包括案名、案号、审理法院、审理程序等，且通常从文本开头到“本案现已审理终结”结束。只输出与”案件基本信息“相关的原文，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',          # \n注意：只输出与”案件基本信息“相关的原文。不要改写原文，不要生成额外的解释或总结。如果找不到相关内容，返回"0"。' ,
    "案名": '请从以下法律判决书中提取与案件"案名"相关的部分。"案名"通常包含双方的名称以及与案件有关的主要纠纷或争议事项，并常常包含"纠纷"一词。只输出原文中的”案名“部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。' ,
    "审理法院": '请从以下法律判决书中提取与"审理法院"相关的部分。"审理法院"通常指负责案件审理的人民法院，文中会明确提到"人民法院"。只输出原文中”审理法院“的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "案号": '请从以下法律判决书中提取与“案号”相关的部分。“案号”通常由“号”字和案件类型（如“民事判决书”）组成。只输出原文中”案号“的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "审理程序": '请从以下法律判决书中找到“审理程序”相关的部分，并推理出其属性值。其可选属性值为：“一审”、“二审”或“再审”。请注意关键词：“初”表示一审、 “终”表示二审、 “再”表示再审。如果找到相关文本，请逐步思考并输出对应的属性值，避免输出任何额外的推理信息。如果没有找到相关文本，请直接返回“0”。',
    "案件基本事实部分": '请从以下法律判决书中提取“案件基本事实部分”相关的部分。该部分通常描述案件的背景、当事人行为及事件经过，二审、再审程序会有之前的法律裁判结果，通常位于判决书的中间部分。请直接提取原文中与“案件基本事实部分”相关的部分，保持原文不变，不要修改、总结或添加任何额外信息。如果没有找到“案件基本事实部分”相关部分，请返回“0”。\n注意：只提取与“案件基本事实部分”相关的原文部分。不要改写、总结原文或生成解释。如果找不到相关内容，返回“0”。',
    "劳动者性别": '请从以下法律判决书中提取“劳动者性别”的属性值。可选属性值为：“男”或“女”。请注意以下关键词：“父亲”、“丈夫”、“儿子”、“哥”指代男性；“母亲”、“妻子”、“女儿”、“妹”、“女工人”指代女性。如果找到相关文本，请逐步思考并输出对应的属性值，避免输出任何额外的推理信息。如果没有找到相关文本，请直接返回“0”。',
    "出生时间": '请从以下法律判决书中提取“出生时间”相关的信息。这一部分通常以具体日期的形式出现。直接输出原文中相关的“出生时间”信息，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "劳动起始时间": '请从以下法律判决书中提取“劳动起始时间”相关的部分。该时间通常与入职或开始工作的相关表述相联系。请关注以下关键词：“入职”、“开始工作”、“自…到…”、“工龄”。请直接提取与劳动起始时间相关的部分，保持原文不变，不要修改或添加额外信息。如果没有找到相关内容，请返回“0”。',
    "劳动结束时间": '请从以下法律判决书中提取“劳动结束时间”相关的部分。该时间通常与“死亡”、“发生交通事故”、“受伤”、“车祸”、“解除劳动合同”、“离开工作岗位”等关键词相关，这些关键词常常与劳动关系的终止有关。只输出原文中与“劳动结束时间”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "开始劳动的年龄": '请从以下法律判决书中提取“开始劳动的年龄”相关的部分。该年龄通常与“入职”、“开始工作”等关键词相关，以及与劳动合同生效、劳动关系建立相关的表述有关。只输出原文中与”开始劳动的年龄“相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "结束劳动的年龄": '请从以下法律判决书中提取“结束劳动的年龄”相关的部分。该年龄通常与“发生交通事故”、“死亡”、“受伤”等关键词相关。只输出原文中与”结束劳动的年龄“相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "有无书面合同": '请从以下法律判决书中提取“有无书面合同”的属性值。可选属性值为：“有”或“无”。请注意以下关键词：“签订书面劳动合同”、“劳务合同”、“雇佣协议书”、“协议书”、“聘用合同书”、“书面劳动合同”、“口头约定”、“无固定期限劳动合同”。如果找到相关文本，请逐步思考并输出对应的属性值，避免输出任何额外的推理信息。如果没有找到相关文本，请直接返回“0”。',
    "仲裁委拒绝仲裁的理由": '请从以下法律判决书中提取“仲裁委拒绝仲裁的理由”相关的部分。该理由通常与“申请仲裁”、“不予受理”、“年龄超过退休年龄”等关键词相关。只输出原文中与“仲裁委拒绝仲裁理由”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "劳动者何时达到法定退休年龄": '请从以下法律判决书中提取“劳动者何时达到法定退休年龄”的属性值。可选属性值为：“劳动期间达到法定退休年龄”或“劳动前达到法定退休年龄”。请注意以下关键词：“乙方已达法定退休年龄”、“入职时已达到法定退休年龄”、“已达到法定退休年龄”、“劳动前达到法定退休年龄”。如果找到相关文本，请逐步思考并输出对应的属性值，避免输出任何额外的推理信息。如果没有找到相关文本，请直接返回“0”。',
    "结束劳动时是否达到法定退休年龄": '请从以下法律判决书中提取“结束劳动时是否达到法定退休年龄”的属性值。可选属性值为：“是”或“否”。请关注关键词：“属于超过法定退休年龄”、“超过法定退休年龄”。如果找到相关文本，请逐步思考并输出对应的属性值，避免输出任何额外的推理信息。如果没有找到相关文本，请直接返回“0”。',
    "有无享受养老保险待遇": '请从以下法律判决书中提取“有无享受养老保险待遇”的属性值。可选属性值为：“有”或“无”。请注意以下关键词：“领取养老金”、“享受”、“城乡居民养老保险”、“城镇居民社会养老保险”、“新型农村社会养老保险”、“城镇职工基本养老保险待遇”。如果找到相关文本，请逐步思考并输出对应的属性值，避免输出任何额外的推理信息。如果没有找到相关文本，请直接返回“0”。',
    "养老保险待遇类型": '请从以下法律判决书中提取“养老保险待遇类型”的属性值。可选属性值为：“城乡居民养老保险”、“城镇居民社会养老保险”、“新型农村社会养老保险”、“城镇职工基本养老保险待遇”。请注意关键词：“城乡居民养老保险”、“城镇居民社会养老保险”、“新型农村社会养老保险”、“城镇职工基本养老保险待遇”。如果找到相关文本，请逐步思考并输出对应的属性值，避免输出任何额外的推理信息。如果没有找到相关文本，请直接返回“0”。',
    "回顾一审法院的认定理由": '请从以下法律判决书中提取“回顾一审法院的认定理由”相关的部分。其只出现在二审和再审判决书中，通常包括一审法院对案件事实的判断、证据的分析以及对当事人主张的评估。只输出原文中与“回顾一审法院的认定理由”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "回顾一审法院的认定依据": '请从以下法律判决书中提取“回顾一审法院的认定依据”相关的部分。其只出现在二审和再审判决书中，通常包括一审法院在做出认定时参考的法律条款、法规或先例，以及案件中的相关证据。只输出原文中与“回顾一审法院的认定依据”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "回顾一审法院的裁判依据": '请从以下法律判决书中提取“回顾一审法院的裁判依据”相关的部分。其只出现在二审和再审判决书中，通常包括一审法院依据的法律原则、相关法律条款以及对案件的适用分析。只输出原文中与“回顾一审法院的裁判依据”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "回顾一审法院的裁判结果": '请从以下法律判决书中提取“回顾一审法院的裁判结果”的属性值。可选属性值为：“劳动关系”或“劳务关系”。相关表述只出现在二审和再审判决书中，关于一审法院裁判结果的总结部分。注意关键词：“裁判结果”、“判决如下”、“判决为”。如果找到相关文本，请逐步思考并输出对应的属性值，避免输出任何额外的推理信息。如果没有找到相关文本，请直接返回“0”。',
    "回顾二审法院的认定理由": '请从以下法律判决书中提取“回顾二审法院的认定理由”相关的部分。其只出现在再审判决书中，通常包括二审法院对案件事实的判断、证据的分析以及对当事人主张的评估。只输出原文中与二审认定理由相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "回顾二审法院的认定依据": '请从以下法律判决书中提取“回顾二审法院的认定依据”相关的部分。其只出现在再审判决书中，通常包括二审法院在做出认定时参考的法律条款、法规或先例，以及案件中的相关证据。只输出原文中与二审认定依据相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "回顾二审法院的裁判依据": '请从以下法律判决书中提取“回顾二审法院的裁判依据”相关的部分。其只出现在再审判决书中，通常包括二审法院依据的法律原则、相关法律条款以及对案件的适用分析。只输出原文中与二审裁判依据相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "回顾二审法院的裁判结果": '请从以下法律判决书中提取“回顾二审法院的裁判结果”的属性值。可选属性值为：“劳动关系”或“劳务关系”。相关表述只出现在再审判决书中，关于二审法院裁判结果的总结部分。注意关键词：“裁判结果”、“判决如下”、“判决为”。如果找到相关文本，请逐步思考并输出对应的属性值，避免输出任何额外的推理信息。如果没有找到相关文本，请直接返回“0”。',
    "理由": '请从以下法律判决书中提取“理由”相关的部分。这一部分通常涉及法院在作出判决时所依据的基本原因和法律原则。一般从“本院认为”开始到“裁判依据”之前结束。只输出原文中与“理由”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "审理法院的认定理由": '请从以下法律判决书中提取“审理法院的认定理由”相关的部分。该部分通常包括法院对案件事实的分析、对证据的评估及对当事人主张的回应。只输出原文中与“审理法院的认定理由”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "审理法院的认定依据": '请从以下法律判决书中提取“审理法院的认定依据”相关的部分。该依据通常包括法院在做出事实认定时参考的法律条款、法规或先例，以及相关证据的引用。只输出原文中与“审理法院的认定依据”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "基本养老保险待遇的认定理由": '请从以下法律判决书中提取“基本养老保险待遇的认定理由”相关的部分。这一部分通常涉及法院对基本养老保险待遇的判定依据，包括对法律规定的理解和适用。只输出原文中与“基本养老保险待遇的认定理由”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "是否认定为基本养老保险待遇": '请从以下法律判决书中提取“是否认定为基本养老保险待遇”的属性值。可选属性值为：“是”或“否”。请关注有关“基本养老保险待遇”的上下文，如果找到相关文本，请逐步思考并输出对应的属性值，避免输出任何额外的推理信息。如果没有找到相关文本，请直接返回“0”。',
    "裁判依据": '请从以下法律判决书中提取“裁判依据”相关的部分。这一部分通常包括法院在作出判决时所依据的法律条款和原则。只输出提取原文中与“裁判依据”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "审理法院的实体裁判依据": '请从以下法律判决书中提取“审理法院的实体裁判依据”相关的部分。该依据通常包括法院在审理案件时所依据的具体法律条款和事实依据。只输出原文中与“审理法院的实体裁判依据”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "裁判主文": '请从以下法律判决书中提取“裁判主文”相关的部分。裁判主文通常以“判决如下”开头，列出法院的最终裁决结果和要求。只输出原文中与“裁判主文”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "审理法院的对应裁判结果": '请从以下法律判决书中提取“审理法院的对应裁判结果”的属性值，可选属性值为：“劳动关系”或“劳务关系”。在处理判决书时，请根据法律程序的不同进行区分：如果是一审判决书，请直接输出当前的判决结果；如果是二审判决书，请注意不要被一审判决结果干扰，而要关注二审对一审判决结果的处理，是维持还是纠正；如果是再审判决书，请同样避免一审和二审的影响，专注于再审程序对这两次判决结果的处理，是撤销还是维持。请逐步思考，找到相关文本后输出该要素的属性值，避免提供任何额外的推理信息。如果没有找到相关内容，请直接返回“0”。',
    "落款": '请从以下法律判决书中提取“落款”相关的部分。该部分通常以”落款“开头，包含审结时间和审理法官。只输出原文中与“落款”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "审结时间": '请从以下法律判决书中提取“审结时间”相关的信息。审结时间通常是法院完成审理并作出裁判的日期，在审理法官之后。只输出原文中与“审结时间”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
    "审理法官": '请从以下法律判决书中提取“审理法官”相关的信息。这一部分通常包括负责案件审理的法官的职务信息和姓名，职务包括“审判长”、“审判员”。只输出原文中与“审理法官”相关的部分，注意：直接提取原文内容，不要改写、总结原文，不要额外补充或生成解释。如果文本中没有相关部分，请返回“0”。',
}

